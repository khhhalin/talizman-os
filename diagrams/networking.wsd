@startuml networking
title Networking & Synchronization

!include enums.wsd
hide enum

class GameState <<Autoload>> {
  + host_game(name: String)
  + join_game(ip: String, name: String)
  + begin_game()
  + end_game()
  --signals--
  + player_list_changed()
  + connection_failed()
  + connection_succeeded()
  + game_ended()
  + game_error(what: String)
}

class NetworkManager <<Node>> {
  + setup_server()
  + setup_client()
  + sync_game_state()
  + handle_player_action(action: Dictionary)
  --rpc--
  + @rpc sync_player_position(player_id: int, position: Vector2)
  + @rpc sync_card_draw(player_id: int, card_data: Dictionary)
  + @rpc sync_combat_result(result: CombatResult)
}

class Player <<CharacterBody2D>> {
  - Vector2 synced_position
  - bool stunned
  + @rpc move_player(space_name: String)
  + @rpc update_stats(stats: Dictionary)
}

class Inputs <<Node>> {
  - Vector2 motion
  - bool bombing
  + update()
}

class PlayerSync <<MultiplayerSynchronizer>>
class InputsSync <<MultiplayerSynchronizer>>

note right of PlayerSync
Replicates (spawn/sync):
 - .:synced_position
 - label:text (spawn only)
Authority: Server
end note

note right of InputsSync
Replicates (spawn/sync):
 - .:motion
 - .:bombing
Authority: Owning client
end note

GameState --> NetworkManager : configures
NetworkManager --> Player : synchronizes
Player --> Inputs : has
Player --> PlayerSync : has
Inputs --> InputsSync : has

@enduml